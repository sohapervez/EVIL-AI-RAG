FROM chromadb/chroma:1.5.0

USER 0

# Create data directory with OpenShift-compatible permissions
RUN mkdir -p /data && \
    chgrp -R 0 /data && \
    chmod -R g=u /data

# Write config that binds to all interfaces
RUN echo 'persist_path: "/data"' > /config.yaml && \
    chgrp 0 /config.yaml && \
    chmod g=u /config.yaml

USER 1000

CMD ["run", "--host", "0.0.0.0", "--port", "8000", "/config.yaml"]
